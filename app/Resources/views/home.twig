{% extends 'templates/app.twig'%}

{% block content %}

    {% for prestation in prestations %}

    <div class="card horizontal">

         <div class="card-image">
            <img style="max-height:300px;" src="{{ uploaddir ~ prestation.nom_image }}">
         </div>

         <div class="card-stacked">
            <div class="card-content">
                <span class="card-title activator grey-text text-darken-4">{{ prestation.nom }}</span>
                <p>{{ prestation.description }}</p>
                <br>
                <div class="ui left action input">
                    <button class="ui teal labeled icon button">
                        <i class="cart icon"></i>
                        Ajouter au Panier
                    </button>
                    <input value="{{ prestation.prix }} €" type="text">
                </div>

                <select class="ui dropdown col s12" name="categorie" id="categorie">
                    <option disabled selected>Choisir une catégorie</option>
                    {% for cat in categories %}
                        <option
                                {% if prestation.categorie_id == cat.id %}
                                    selected
                                {% endif %}
                                value="{{ cat.id }}">{{cat.nom}}</option>
                    {% endfor %}
                </select>
             </div>
             <div>
                 {%  set class ='' %}
                 {% for rate in ratings  if prestation.id == rate.prestation_id  %}
                     {% for note in ratings %}
                         {% if    current_user in userratings[loop.index-1] and  prestation.id == note.prestation_id %}  {% set class = 'jDisabled' %} {% endif %}
                     {% endfor %}
                     <div class="rating {{ class }}" id="{{ rate.rating }}_{{ rate.prestation_id }}" >{{ csrf.field | raw }}</div>

                 {% else %}
                     <div class="rating {{ class }}" id="0_5" >{{ csrf.field | raw }}</div>
                 {% endfor %}
             </div>
            <div class="card-action">
                <a href="{{ base_path }}/prestations/{{prestation.id}}">READ MORE</a>
        {% if user.role == 1 %}
        {% if prestation.etat == 0 %}
                <a href="{{ path_for('activate_prestation',{'prestation_id' : prestation.id }) }}" class="waves-effect waves-light btn blue">Activer</a>
         {% else %}
                <a href="{{ path_for('deactivate_prestation',{'prestation_id' : prestation.id }) }}" class="waves-effect waves-light btn blue">Désactiver</a>
         {% endif %}
                <a  href="{{ path_for('delete_prestation',{'prestation_id' : prestation.id }) }}" class="waves-effect waves-light btn red">Supprimer</a>
         {% endif %}
            </div>
        </div> 
    </div>

    {% endfor %}
    
        <ul class="pagination center-align">

            <li class="{{ prestations.previousPageUrl ? 'waves-effect' : 'disabled' }}"><a href="{{ prestations.previousPageUrl ? base_path ~ prestations.previousPageUrl : '#' }}"><i class="material-icons">chevron_left</i></a></li>

            <li class="{{ prestations.nextPageUrl ? 'waves-effect' : 'disabled' }}"><a href="{{ prestations.nextPageUrl ? base_path ~ prestations.nextPageUrl : '#' }}"><i class="material-icons">chevron_right</i></a></li>

         </ul>

{% endblock %}